<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/base/_reset.css">
  <link rel="stylesheet" href="css/base/normalize.css">
  <link rel="stylesheet" href="css/base/_fontStyle.css">
  <link rel="stylesheet" href="css/base/_basicStyle.css">
  <link rel="stylesheet" href="css/layout/_navbar.css">
  <link rel="stylesheet" href="css/pages/index.css">
  <link rel="stylesheet" href="css/components/pie.css">
  <link rel="stylesheet" href="css/components/loading.css">
  <!-- oringinal -->
  <script src="js/vue.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="js/cookie.js"></script>

  <title>大潭火力發電廠門禁管理系統</title>
</head>

<body>
  <!-- header -->
  <nav id="navbar" class="navbar">
    <div class="container">
      <div class="elements align_center ver-align fs-20">
        <div id="menuya" class="ver-align">
          <!-- <button class="menubtn bl_word" onclick="drop()" id="menu">選單<i id="icon" class="material-icons">keyboard_arrow_down</i></button> -->
        </div>
        <div class="nav-title">
          <img src="img/台電.png" alt="台電">
          <span class="fw-600">大潭火力發電廠門禁管理系統</span>
        </div>
        <a class="bl_word" href="">返回</a>
      </div>
      <!-- <div id="menudrop" class="menudrop" style="display: none;">
          <button onclick="self.location.href='#'" class="btn wh_word fw-900" style="background-color:#AFAFAF;">首頁</button>
          <button onclick="self.location.href='#'" class="btn people_btn wh_word fw-900">人數資料</button>
          <button onclick="self.location.href='#'" class="btn peopleWork_btn  wh_word fw-900">承攬發包資料</button>
          <button onclick="self.location.href='#'" class="btn car_btn  wh_word fw-900">車輛資料</button>
      </div> -->
    </div>
  </nav>
  <div id="refresh">
    <button id="refreshtime">更新時間：</button>
  </div>
  <div id="load"></div>
  <section class="index" style="margin-top: 80px; height:calc(100vh - 80px);width:100vw;">
    <div class="container">
      <div id="index" class="flex">
        <div class="flex align_center ver-align h-100" style="width:100%; flex-wrap:nowrap" id="con1">
          <div class="box grow-1 mg-10 h-100 peopleMonth flex ver-align" style="width: 25%;" id="con1-1">
            <p class="bl_word fs-18 grow-1">本月累積<br>進廠人次</p>
            <p class="people_word fs-50 fw-900 grow-1">{{ peopleMonth }}</p>
          </div>
          <div style="display: flex; flex-grow:2;" id="con1-2">
            <button onclick="javascript:location.href='people.html'" id="people"
              class="btn people_btn mg-10 fs-20 fw-900 h-100">人數資料</button>
            <button onclick="javascript:location.href='company.html'" id="company"
              class="btn peopleWork_btn mg-10 fs-20 fw-900 h-100">承攬發包資料</button>
            <button onclick="javascript:location.href='car.html'" id="car"
              class="btn car_btn mg-10 fs-20 fw-900 h-100">車輛資料</button>
            <button onclick="javascript:location.href='entry.html'" id="entry"
              class="btn entry_btn mg-10 fs-20 fw-900 h-100">辨識通關資料</button>
          </div>
        </div>
        <div class="wrapper">
          <div class="flex grow-1 box mg-10 h-220 ver-align">
            <div class="grow-1 peopleDay_chart">
              <!-- <div class="peopleDay_piechart" data-percent="0"> -->
                <!-- <div class="peopleDay_progress">
                  <div id="peopleDay_chart" class="peopleDay_progress-fill"></div>
                </div> -->
                <div class="peopleDay_percents">
                  <div class="peopleDay_percents-wrapper">
                    <span>{{ peopleDay_chart }}</span>
                  </div>
                </div>
              <!-- </div> -->
              <p style="margin-top: 15px;">今日進廠總人數</p>
            </div>
            <div class="grow-1 peopleCurrent_chart">
              <div class="peopleCurrent_piechart" data-percent="100">
                <div class="peopleCurrent_progress">
                  <div id="peopleCurrent_chart" class="peopleCurrent_progress-fill"></div>
                </div>
                <div class="peopleCurrent_percents">
                  <div class="peopleCurrent_percents-wrapper">
                    <span>{{ peopleCurrent_chart }}</span>
                  </div>
                </div>
              </div>
              <p style="margin-top: 15px;">目前廠內人數</p>
            </div>
            <div class="grow-1 peopleInDay_chart">
              <!-- <div class="peopleInDay_piechart" data-percent="0"> -->
                <!-- <div class="peopleInDay_progress">
                  <div id="peopleInDay_chart" class="peopleInDay_progress-fill"></div>
                </div> -->
                <div class="peopleInDay_percents">
                  <div class="peopleInDay_percents-wrapper">
                    <span>{{ peopleInDay_chart }}</span>
                  </div>
                </div>
              <!-- </div> -->
              <p style="margin-top: 15px;">今日機組區總人數</p>
            </div>
            <div class="grow-1 peopleInCurrent_chart">
              <div class="peopleInCurrent_piechart" data-percent="100">
                <div class="peopleInCurrent_progress">
                  <div id="peopleInCurrent_chart" class="peopleInCurrent_progress-fill"></div>
                </div>
                <div class="peopleInCurrent_percents">
                  <div class="peopleInCurrent_percents-wrapper">
                    <span>{{ peopleInCurrent_chart }}</span>
                  </div>
                </div>
              </div>
              <p style="margin-top: 15px;">目前機組區人數</p>
            </div>
          </div>
          <div class="flex mg-10 h-220 align_center" style="margin-top: 20px;">
            <div class="box car grow-1">
              <p class="bl_word fs-18 pd-10">當日進廠車輛數</p>
              <div class="line"></div>
              <p class="bl_word fs-18 pd-5 carFlowIn" style="padding-top:30px;">汽車</p>
              <p class="car_word fs-40 fw-900">{{ carFlowIn }}</p>
              <p class="bl_word fs-18 pd-5 scooterFlowIn">機車</p>
              <p class="car_word fs-40 fw-900">{{ scooterFlowIn }}</p>
            </div>
            <div class="box contractOut grow-1">
              <div class="align_center" style="margin-right: 120px;">
                <p class="peopleWork_word fs-40 fw-900">{{ contractOutToday }}</p>
                <p class="bl_word fs-16 pd-5 carFlowIn">發包數量</p>
              </div>
              <div class="align_center" style="margin-left: 120px;">
                <p class="peopleWork_word fs-40 fw-900">{{ contractOutTotal }}</p>
                <p class="bl_word fs-16 pd-5 carFlowIn">總發包數量</p>
              </div>
            </div>
            <div class="box company grow-1">
              <div class="align_center" style="margin-right: 120px;">
                <p class="peopleWork_word fs-40 fw-900">{{ companyToday }}</p>
                <p class="bl_word fs-16 pd-5 carFlowIn">承攬公司數量</p>
              </div>
              <div class="align_center" style="margin-left: 120px;">
                <p class="peopleWork_word fs-40 fw-900">{{ companyTotal }}</p>
                <p class="bl_word fs-16 pd-5 carFlowIn">總承攬公司數量</p>
              </div>
            </div>
          </div>
        </div>
        <div class="grow-1 ">
          <div class="flex-1000">
            <div class="box pd-20 mg-10 h-100 peopleWork flex ver-align">
              <p class="align_left bl_word fs-18 grow-1">廠內<br>點工人數</p>
              <p class="align_right peopleWork_word fs-50 fw-900 grow-1">{{ peopleWork }}</p>
            </div>
            <div class="box pd-20 mg-10 h-100 peopleUnWork flex ver-align">
              <p class="align_left bl_word fs-18 grow-1">廠內<br>無效人力人數</p>
              <p class="align_right peopleWork_word fs-50 fw-900 grow-1">{{ peopleUnWork }}
              </p>
            </div>
          </div>
          <div class="flex-1000">
            <div class="box pd-20 mg-10 h-100 peopleInWork flex ver-align">
              <p class="align_left bl_word fs-18 grow-1">機組區<br>點工人數</p>
              <p class="align_right peopleWork_word fs-50 fw-900 grow-1">{{ peopleInWork }}
              </p>
            </div>
            <div class="box pd-20 mg-10 h-100 peopleInUnWork flex ver-align">
              <p class="align_left bl_word fs-18 grow-1">機組區<br>無效人力人數</p>
              <p class="align_right peopleWork_word fs-50 fw-900 grow-1">{{ peopleInUnWork }}
              </p>
            </div>
          </div>
        </div>
      </div>
  </section>
  <!-- components -->
  <script src="js/dropdownmenu.js"></script>
  <script>
    let index = new Vue({
      el: "#index",/*定義Vue作用範圍，el指的是element*/
      data: {
        peopleMonth: '',
        peopleWork: '',
        peopleUnWork: '',
        peopleInWork: '',
        peopleInUnWork: '',
        contractOutTotal: '',
        contractOutToday: '',
        companyTotal: '',
        companyToday: '',
        carFlowIn: '',
        scooterFlowIn: '',
        peopleDay_chart: '',
        peopleCurrent_chart: '',
        peopleInDay_chart: '',
        peopleInCurrent_chart: '',
      },
      methods: { //methods是關鍵字 
        mainpage: function () {
          let vm = this;
          $.ajax({
            url: "http://192.168.50.47:8002/api/NumberOfPeople.aspx",
            method: "post", //直接傳遞物件
            beforeSend: function () {
              $("#overlay").fadeIn(1000);
            },
            success: function (evt) {
              vm.message = "";
              $.each(JSON.parse(evt), function (k, item) {

                switch (item.Text) {
                  case "peopleMonth":
                    index.peopleMonth = item.Count;
                    break;
                  case "peopleWork":
                    index.peopleWork = item.Count;
                    break;
                  case "peopleUnWork":
                    index.peopleUnWork = item.Count;
                    break;
                  case "peopleInWork":
                    index.peopleInWork = item.Count;
                    break;
                  case "peopleInUnWork":
                    index.peopleInUnWork = item.Count;
                    break;
                  case "contractOutTotal":
                    index.contractOutTotal = item.Count;
                    break;
                  case "contractOutToday":
                    index.contractOutToday = item.Count;
                    break;
                  case "companyTotal":
                    index.companyTotal = item.Count;
                    break;
                  case "companyToday":
                    index.companyToday = item.Count;
                    break;
                  case "carFlowIn":
                    index.carFlowIn = item.Count;
                    break;
                  case "scooterFlowIn":
                    index.scooterFlowIn = item.Count;
                    break;
                  case "peopleDay_chart":
                    index.peopleDay_chart = item.Count;
                    break;
                  case "peopleCurrent_chart":
                    index.peopleCurrent_chart = item.Count;
                    break;
                  case "peopleInDay_chart":
                    index.peopleInDay_chart = item.Count;
                    break;
                  case "peopleInCurrent_chart":
                    index.peopleInCurrent_chart = item.Count;
                    break;
                }
              })
            },
            complete: function () {
              if (index.peopleCurrent_chart == "0") {
                document.getElementById('peopleCurrent_chart').style.background = "#E5E5E5";
              }
              if (index.peopleInCurrent_chart == "0") {
                document.getElementById('peopleInCurrent_chart').style.background = "#E5E5E5";
              }
              $("#overlay").fadeOut(300);
              setTimeout(index.mainpage, 600000);
              chartdrawA();
              chartdrawB(); 
              var today = new Date();
              var y = today.getFullYear();//年份
              //不足兩位數補零
              var mo = (today.getMonth() + 1 < 10 ? '0' : '') + (today.getMonth() + 1);//月份
              var d = (today.getDate() < 10 ? '0' : '') + today.getDate();//日期
              var h = (today.getHours() < 10 ? '0' : '') + today.getHours();//小時
              var m = (today.getMinutes() < 10 ? '0' : '') + today.getMinutes();//分鐘
              var s = (today.getSeconds() < 10 ? '0' : '') + today.getSeconds();//秒
              var currentDateTime = y + '/' + mo + '/' + d + '/ ' + h + ':' + m + ':' + s;
              document.getElementById('refreshtime').innerHTML = '更新時間：' + currentDateTime;
            }
          });
        }
      }
    });
    $(document).ready(function () {
      setTimeout(index.mainpage, 1000);
    })
  </script>
  <script>
    $("#load").load("loading.html");
  </script>
  <script>
    function chartdrawA() {
      var a = index.peopleCurrent_chart
      var b = index.peopleDay_chart
      var peopleCurrent = $('.peopleCurrent_piechart'),
        percent = a / b
      deg = 360 * percent;
      if (deg > 180) {
        peopleCurrent.addClass('gt-50');
      }
      $('.peopleCurrent_progress-fill').css('transform', 'rotate(' + deg + 'deg)');
    };
    function chartdrawB() {
      var a = index.peopleInCurrent_chart
      var b = index.peopleInDay_chart
      var peopleInCurrent = $('.peopleInCurrent_piechart'),
        percent = a / b
      deg = 360 * percent;
      if (deg > 180) {
        peopleInCurrent.addClass('gt-50');
      }
      $('.peopleInCurrent_progress-fill').css('transform', 'rotate(' + deg + 'deg)');
    };
  </script>
</body>

</html>